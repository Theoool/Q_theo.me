---
title: D3.js ä»é›¶æ„å»ºäº¤äº’å¼åœ°å›¾ç»„ä»¶
description: æ·±å…¥è§£æå¦‚ä½•ä½¿ç”¨ D3.js å’Œ Vue 3 æ„å»ºåŠŸèƒ½å®Œæ•´çš„äº¤äº’å¼åœ°å›¾ç»„ä»¶ï¼Œæ¶µç›–åœ°ç†æŠ•å½±ã€æ•°æ®ç»‘å®šã€äº‹ä»¶å¤„ç†ç­‰æ ¸å¿ƒæŠ€æœ¯
date: 2025-1-14T08:00:00.000+00:00
type: blog
duration: 15min
---



åœ¨ç°ä»£ Web å¼€å‘ä¸­ï¼Œæ•°æ®å¯è§†åŒ–å·²æˆä¸ºä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚D3.js ä½œä¸ºæœ€å¼ºå¤§çš„æ•°æ®é©±åŠ¨æ–‡æ¡£åº“ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†æ— ä¸ä¼¦æ¯”çš„çµæ´»æ€§æ¥åˆ›å»ºè‡ªå®šä¹‰åŠ¨æ€å¯è§†åŒ–ã€‚æœ¬æ–‡å°†é€šè¿‡å®é™…é¡¹ç›®æ¡ˆä¾‹ï¼Œè¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨ D3.js å’Œ Vue 3 æ„å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„äº¤äº’å¼åœ°å›¾ç»„ä»¶ã€‚

## ä»€ä¹ˆæ˜¯ D3.jsï¼Ÿ

> D3.js (Data-Driven Documents) æ˜¯ä¸€ä¸ªç”¨æ•°æ®é©±åŠ¨ DOM çš„ JavaScript å‡½æ•°åº“ã€‚å…¶æ ¸å¿ƒç†å¿µæ˜¯ï¼š**ç»‘å®šæ•°æ®ï¼ŒDOM éšæ•°æ®å˜åŒ–ï¼Œæ²¡æœ‰é¢„è®¾ï¼Œä¸€åˆ‡ç”±æ•°æ®å†³å®š**ã€‚

D3.js çš„å¼ºå¤§ä¹‹å¤„åœ¨äºå®ƒä¸æ˜¯ä¸€ä¸ªå›¾è¡¨åº“ï¼Œè€Œæ˜¯ä¸€ä¸ªåº•å±‚çš„å¯è§†åŒ–å·¥å…·åŒ…ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿï¼š

- ğŸ¯ **ç²¾ç¡®æ§åˆ¶**ï¼šå¯¹æ¯ä¸ªè§†è§‰å…ƒç´ éƒ½æœ‰å®Œå…¨çš„æ§åˆ¶æƒ
- ğŸ”„ **æ•°æ®ç»‘å®š**ï¼šå°†æ•°æ®ç›´æ¥ç»‘å®šåˆ° DOM å…ƒç´ 
- ğŸ¨ **æ— é™åˆ›æ„**ï¼šä¸å—é¢„è®¾å›¾è¡¨ç±»å‹é™åˆ¶
- âš¡ **é«˜æ€§èƒ½**ï¼šåŸºäº SVG å’Œ Canvas çš„é«˜æ•ˆæ¸²æŸ“

## é¡¹ç›®æ¶æ„è®¾è®¡

åœ¨å¼€å§‹ç¼–ç ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£æ•´ä¸ªåœ°å›¾ç»„ä»¶çš„æ¶æ„ï¼š

```
ğŸ“ src/components/map/
â”œâ”€â”€ ğŸ“„ map.vue           # ä¸»ç»„ä»¶æ–‡ä»¶
â”œâ”€â”€ ğŸ“ mapjson/          # åœ°å›¾æ•°æ®æ–‡ä»¶
â”‚   â”œâ”€â”€ map.json         # å…¨å›½åœ°å›¾æ•°æ®
â”‚   â””â”€â”€ qinghai.json     # é’æµ·çœåœ°å›¾æ•°æ®
â””â”€â”€ ğŸ“„ index.ts          # å¯¼å‡ºæ–‡ä»¶
```

## æ ¸å¿ƒæŠ€æœ¯æ ˆ

æˆ‘ä»¬çš„åœ°å›¾ç»„ä»¶åŸºäºä»¥ä¸‹æŠ€æœ¯æ ˆæ„å»ºï¼š

- **Vue 3 Composition API**ï¼šç»„ä»¶é€»è¾‘ç»„ç»‡
- **D3.js**ï¼šæ•°æ®å¯è§†åŒ–æ ¸å¿ƒåº“
- **TopoJSON**ï¼šåœ°ç†æ•°æ®æ ¼å¼å¤„ç†
- **TypeScript**ï¼šç±»å‹å®‰å…¨ä¿éšœ

## ç¬¬ä¸€æ­¥ï¼šç»„ä»¶åŸºç¡€ç»“æ„

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»º Vue ç»„ä»¶çš„åŸºç¡€ç»“æ„ï¼š

```vue
<template>
  <div class="map-container">
    <div ref="mapContainer" class="map-wrapper" />
    <div v-if="selectedCity" class="city-tooltip">
      {{ selectedCity }}
    </div>
    <div v-if="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>
  </div>
</template>

<script setup lang="ts">
import * as d3 from 'd3'
import * as topojson from 'topojson-client'
import { nextTick, onMounted, ref } from 'vue'

// ç»„ä»¶å±æ€§å®šä¹‰
const props = withDefaults(
  defineProps<{
    width?: number
    height?: number
    darkMode?: boolean
    mapData: any
    arrive: string[]
  }>(),
  {
    width: 500,
    height: 400,
    darkMode: false,
  },
)

// å“åº”å¼çŠ¶æ€
const mapContainer = ref<HTMLElement>()
const selectedCity = ref<string | null>(null)
const errorMessage = ref<string>('')
let pathGenerator: d3.GeoPath<any, d3.GeoPermissibleObjects> | null = null
</script>
```

## ç¬¬äºŒæ­¥ï¼šåœ°ç†æ•°æ®å¤„ç†

D3.js åœ°å›¾å¯è§†åŒ–çš„æ ¸å¿ƒæ˜¯å¤„ç†åœ°ç†æ•°æ®ã€‚æˆ‘ä»¬ä½¿ç”¨ TopoJSON æ ¼å¼ï¼Œå®ƒæ¯” GeoJSON æ›´ç´§å‡‘ä¸”æ”¯æŒæ‹“æ‰‘å…³ç³»ï¼š

```typescript
const drawMap = async () => {
  try {
    if (!mapContainer.value || !props.mapData) return

    // æ¸…ç©ºå®¹å™¨
    d3.select(mapContainer.value).selectAll('*').remove()

    // å¤„ç† TopoJSON æ•°æ®
    const data = props.mapData
    const objectKeys = Object.keys(data.objects)
    if (objectKeys.length === 0) {
      throw new Error('åœ°å›¾æ•°æ®æ ¼å¼é”™è¯¯ï¼šç¼ºå°‘ objects å±æ€§')
    }

    // è½¬æ¢ä¸º GeoJSON æ ¼å¼
    const geojson = topojson.feature(data, data.objects[objectKeys[0]])
    
    // åˆ›å»º SVG å®¹å™¨
    const svg = d3.select(mapContainer.value)
      .append('svg')
      .attr('width', props.width)
      .attr('height', props.height)
      .attr('viewBox', `0 0 ${props.width} ${props.height}`)
      .style('background', 'transparent')
  } catch (error) {
    console.error('ç»˜åˆ¶åœ°å›¾æ—¶å‡ºé”™:', error)
    errorMessage.value = `ç»˜åˆ¶åœ°å›¾å¤±è´¥: ${error.message}`
  }
}
```

## ç¬¬ä¸‰æ­¥ï¼šåœ°ç†æŠ•å½±è®¾ç½®

åœ°ç†æŠ•å½±æ˜¯å°†çƒé¢åæ ‡ï¼ˆç»çº¬åº¦ï¼‰è½¬æ¢ä¸ºå¹³é¢åæ ‡çš„å…³é”®æ­¥éª¤ï¼š

```typescript
// è®¾ç½®åœ°ç†æŠ•å½±
const projection = d3.geoIdentity()
  .reflectY(true) // æ ¹æ®æ•°æ®æºè°ƒæ•´Yè½´æ–¹å‘
  .fitSize([props.width - 40, props.height - 40], geojson)

// åˆ›å»ºè·¯å¾„ç”Ÿæˆå™¨
pathGenerator = d3.geoPath().projection(projection)
```

**å…³é”®æ¦‚å¿µè§£æï¼š**

- `d3.geoIdentity()`ï¼šåˆ›å»ºæ’ç­‰æŠ•å½±ï¼Œé€‚ç”¨äºå·²ç»æ˜¯å¹³é¢åæ ‡çš„æ•°æ®
- `reflectY(true)`ï¼šåè½¬ Y è½´ï¼Œå› ä¸º SVG åæ ‡ç³» Y è½´å‘ä¸‹
- `fitSize()`ï¼šè‡ªåŠ¨ç¼©æ”¾å’Œå¹³ç§»ï¼Œä½¿åœ°å›¾é€‚åº”æŒ‡å®šå°ºå¯¸
- `d3.geoPath()`ï¼šæ ¹æ®æŠ•å½±ç”Ÿæˆ SVG è·¯å¾„å­—ç¬¦ä¸²

## ç¬¬å››æ­¥ï¼šæ¸²æŸ“åœ°å›¾åŒºåŸŸ

ä½¿ç”¨ D3.js çš„æ•°æ®ç»‘å®šæ¨¡å¼æ¸²æŸ“åœ°å›¾ï¼š

```typescript
// ç»˜åˆ¶åœ°å›¾åŒºåŸŸ
const cities = svg.selectAll('.city')
  .data(geojson.features)
  .enter()
  .append('path')
  .attr('class', 'city')
  .attr('d', pathGenerator)
  .attr('fill', '#4B4B4B')
  .attr('stroke', '#6c757d')
  .attr('stroke-width', 0.8)
  .style('cursor', 'pointer')
  .style('transition', 'all 0.2s cubic-bezier(0.4, 0, 0.2, 1)')
```

**D3.js æ•°æ®ç»‘å®šä¸‰æ­¥æ›²ï¼š**

1. **é€‰æ‹©**ï¼š`selectAll('.city')` é€‰æ‹©æ‰€æœ‰ `.city` å…ƒç´ 
2. **ç»‘å®š**ï¼š`.data(geojson.features)` å°†æ•°æ®ç»‘å®šåˆ°é€‰æ‹©é›†
3. **æ“ä½œ**ï¼š`.enter().append('path')` ä¸ºæ–°æ•°æ®åˆ›å»ºå…ƒç´ 

## ç¬¬äº”æ­¥ï¼šäº¤äº’åŠŸèƒ½å®ç°

ä¸ºåœ°å›¾æ·»åŠ ä¸°å¯Œçš„äº¤äº’ä½“éªŒï¼š

```typescript
cities
  .on('mouseenter', function (event, d) {
    const cityName = d.properties.name || d.properties.NAME || 'æœªçŸ¥åŒºåŸŸ'
    const isHighlighted = arrive.includes(cityName)

    // é¼ æ ‡æ‚¬åœæ•ˆæœ
    d3.select(this)
      .attr('fill', isHighlighted ? '#343a40' : '#e9ecef')
      .attr('stroke', '#212529')
      .attr('stroke-width', 1.5)
      .style('filter', 'drop-shadow(0 2px 8px rgba(0,0,0,0.15))')

    selectedCity.value = cityName
  })
  .on('mouseleave', function (event, d) {
    const cityName = d.properties.name || d.properties.NAME || 'æœªçŸ¥åŒºåŸŸ'
    const isHighlighted = arrive.includes(cityName)

    // æ¢å¤åŸå§‹æ ·å¼
    d3.select(this)
      .attr('fill', isHighlighted ? '#fff' : '#4B4B4B')
      .attr('stroke', '#6c757d')
      .attr('stroke-width', 0.8)
      .style('filter', 'none')

    selectedCity.value = null
  })
  .on('click', (event, d) => {
    const cityName = d.properties.name || d.properties.NAME || 'æœªçŸ¥åŒºåŸŸ'
    console.log('é€‰ä¸­åŸå¸‚:', cityName)
    // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤šç‚¹å‡»å¤„ç†é€»è¾‘
  })
```

## ç¬¬å…­æ­¥ï¼šæ·»åŠ æ–‡æœ¬æ ‡ç­¾

ä¸ºåœ°å›¾åŒºåŸŸæ·»åŠ åç§°æ ‡ç­¾ï¼š

```typescript
// æ·»åŠ åŸå¸‚åç§°æ ‡ç­¾
svg.selectAll('.city-label')
  .data(geojson.features)
  .enter()
  .append('text')
  .attr('class', 'city-label')
  .attr('x', d => pathGenerator.centroid(d)[0])
  .attr('y', d => pathGenerator.centroid(d)[1])
  .attr('text-anchor', 'middle')
  .attr('dy', '0.35em')
  .style('font-size', '11px')
  .style('font-weight', '500')
  .style('fill', '#212529')
  .style('pointer-events', 'none') // é˜²æ­¢é˜»æŒ¡é¼ æ ‡äº‹ä»¶
  .style('user-select', 'none')
  .text(d => d.properties.name || d.properties.NAME || 'æœªçŸ¥åŒºåŸŸ')
```

**å…³é”®æŠ€æœ¯ç‚¹ï¼š**

- `pathGenerator.centroid(d)`ï¼šè®¡ç®—åœ°ç†è¦ç´ çš„ä¸­å¿ƒç‚¹
- `pointer-events: none`ï¼šç¡®ä¿æ–‡æœ¬ä¸ä¼šé˜»æŒ¡é¼ æ ‡äº‹ä»¶
- `text-anchor: middle`ï¼šæ–‡æœ¬æ°´å¹³å±…ä¸­å¯¹é½

## ç¬¬ä¸ƒæ­¥ï¼šæ ·å¼ä¼˜åŒ–

é€šè¿‡ CSS æå‡è§†è§‰æ•ˆæœï¼š

```vue
<style scoped>
.map-container {
  position: relative;
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  overflow: hidden;
  border: 1px solid #dee2e6;
}

.map-wrapper {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

:deep(.city) {
  will-change: fill, stroke, filter;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

.city-tooltip {
  position: absolute;
  top: 10px;
  left: 10px;
  background: rgba(33, 37, 41, 0.9);
  color: #f8f9fa;
  padding: 8px 12px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  backdrop-filter: blur(4px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  z-index: 10;
}

.error-message {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #f8d7da;
  color: #721c24;
  padding: 12px 16px;
  border-radius: 8px;
  border: 1px solid #f5c6cb;
  font-size: 14px;
  text-align: center;
  max-width: 80%;
}
</style>
```

## ç¬¬å…«æ­¥ï¼šç»„ä»¶ä½¿ç”¨ç¤ºä¾‹

å®Œæˆç»„ä»¶å¼€å‘åï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ä½¿ç”¨å®ƒï¼š

```vue
<template>
  <div>
    <h2>ä¸­å›½åœ°å›¾</h2>
    <Map
      :map-data="chinaMapData"
      :arrive="visitedCities"
      :width="600"
      :height="400"
    />
  </div>
</template>

<script setup>
import Map from '@/components/map/map.vue'
import chinaMapData from '@/data/map/china.json'

const visitedCities = ['åŒ—äº¬å¸‚', 'ä¸Šæµ·å¸‚', 'å¹¿å·å¸‚', 'æ·±åœ³å¸‚']
</script>
```

## æ ¸å¿ƒ D3.js æ¦‚å¿µæ€»ç»“

é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬æŒæ¡äº† D3.js çš„æ ¸å¿ƒæ¦‚å¿µï¼š

### 1. é€‰æ‹©å™¨ (Selections)
```javascript
d3.select()    // é€‰æ‹©å•ä¸ªå…ƒç´ 
d3.selectAll() // é€‰æ‹©å¤šä¸ªå…ƒç´ 
```

### 2. æ•°æ®ç»‘å®š (Data Binding)
```javascript
selection.data(data)           // ç»‘å®šæ•°æ®
         .enter()              // å¤„ç†æ–°æ•°æ®
         .append('element')    // åˆ›å»ºå…ƒç´ 
```

### 3. å±æ€§è®¾ç½® (Attributes)
```javascript
selection.attr('name', value)  // è®¾ç½®å±æ€§
         .style('name', value) // è®¾ç½®æ ·å¼
         .text(value)          // è®¾ç½®æ–‡æœ¬
```

### 4. äº‹ä»¶å¤„ç† (Event Handling)
```javascript
selection.on('event', handler) // ç»‘å®šäº‹ä»¶
```

## D3.js ç”Ÿæ€ç³»ç»Ÿ

D3.js æ˜¯ä¸€ä¸ªæ¨¡å—åŒ–çš„åº“ï¼ŒåŒ…å«å¤šä¸ªä¸“é—¨çš„å­æ¨¡å—ï¼š

- **d3-selection**: DOM é€‰æ‹©å’Œæ“ä½œ
- **d3-scale**: æ•°æ®åŸŸåˆ°åƒç´ åŸŸçš„æ˜ å°„
- **d3-axis**: è‡ªåŠ¨ç”Ÿæˆåæ ‡è½´
- **d3-shape**: ç”ŸæˆæŠ˜çº¿ã€é¢ç§¯ã€é¥¼å›¾è·¯å¾„
- **d3-transition**: å¹³æ»‘åŠ¨ç”»è¿‡æ¸¡
- **d3-fetch**: åŠ è½½ CSV/JSON æ•°æ®
- **d3-geo**: åœ°ç†æŠ•å½±å’Œè·¯å¾„ç”Ÿæˆ
- **d3-force**: åŠ›å¯¼å‘å¸ƒå±€ï¼ˆå…³ç³»ç½‘ç»œå›¾ï¼‰
- **d3-brush**: çŸ©å½¢é€‰æ¡†äº¤äº’
- **d3-drag**: å…ƒç´ æ‹–æ‹½åŠŸèƒ½
- **d3-zoom**: ç¼©æ”¾å’Œå¹³ç§»äº¤äº’

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **ä½¿ç”¨ `will-change` CSS å±æ€§**ï¼šæç¤ºæµè§ˆå™¨ä¼˜åŒ–åŠ¨ç”»æ€§èƒ½
2. **åˆç†ä½¿ç”¨ `transition`**ï¼šé¿å…è¿‡åº¦çš„åŠ¨ç”»æ•ˆæœ
3. **æ•°æ®é¢„å¤„ç†**ï¼šåœ¨ç»„ä»¶å¤–éƒ¨å¤„ç†å¤æ‚çš„æ•°æ®è½¬æ¢
4. **äº‹ä»¶å§”æ‰˜**ï¼šå¯¹äºå¤§é‡å…ƒç´ ï¼Œè€ƒè™‘ä½¿ç”¨äº‹ä»¶å§”æ‰˜
5. **æŒ‰éœ€åŠ è½½**ï¼šåªå¯¼å…¥éœ€è¦çš„ D3.js æ¨¡å—

## æ‰©å±•åŠŸèƒ½å»ºè®®

åŸºäºå½“å‰çš„åœ°å›¾ç»„ä»¶ï¼Œä½ å¯ä»¥ç»§ç»­æ·»åŠ ä»¥ä¸‹åŠŸèƒ½ï¼š

- ğŸ” **ç¼©æ”¾å’Œå¹³ç§»**ï¼šä½¿ç”¨ `d3-zoom` å®ç°åœ°å›¾ç¼©æ”¾
- ğŸ“Š **æ•°æ®å¯è§†åŒ–**ï¼šåœ¨åœ°å›¾ä¸Šå åŠ ç»Ÿè®¡æ•°æ®
- ğŸ¨ **ä¸»é¢˜åˆ‡æ¢**ï¼šæ”¯æŒæ˜æš—ä¸»é¢˜åˆ‡æ¢
- ğŸ“± **å“åº”å¼è®¾è®¡**ï¼šé€‚é…ä¸åŒå±å¹•å°ºå¯¸
- ğŸ¯ **å®šä½åŠŸèƒ½**ï¼šæ”¯æŒåœ°ç†å®šä½å’Œæ ‡è®°
- ğŸ“ˆ **åŠ¨ç”»æ•ˆæœ**ï¼šæ·»åŠ æ•°æ®å˜åŒ–çš„åŠ¨ç”»è¿‡æ¸¡

## æ€»ç»“

é€šè¿‡è¿™ä¸ªå®æˆ˜é¡¹ç›®ï¼Œæˆ‘ä»¬æ·±å…¥äº†è§£äº† D3.js åœ¨åœ°å›¾å¯è§†åŒ–ä¸­çš„åº”ç”¨ã€‚D3.js çš„å¼ºå¤§ä¹‹å¤„åœ¨äºå®ƒæä¾›äº†åº•å±‚çš„æ„å»ºå—ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿåˆ›å»ºå®Œå…¨è‡ªå®šä¹‰çš„å¯è§†åŒ–æ•ˆæœã€‚è™½ç„¶å­¦ä¹ æ›²çº¿ç›¸å¯¹é™¡å³­ï¼Œä½†ä¸€æ—¦æŒæ¡ï¼Œä½ å°†æ‹¥æœ‰åˆ›å»ºä»»ä½•æ•°æ®å¯è§†åŒ–çš„èƒ½åŠ›ã€‚

è®°ä½ D3.js çš„æ ¸å¿ƒç†å¿µï¼š**æ•°æ®é©±åŠ¨æ–‡æ¡£**ã€‚è®©æ•°æ®å†³å®šè§†è§‰å‘ˆç°ï¼Œè€Œä¸æ˜¯è¢«é¢„è®¾çš„å›¾è¡¨ç±»å‹æ‰€é™åˆ¶ã€‚è¿™æ­£æ˜¯ D3.js ä¸å…¶ä»–å›¾è¡¨åº“çš„æ ¹æœ¬åŒºåˆ«ï¼Œä¹Ÿæ˜¯å®ƒå¦‚æ­¤å¼ºå¤§å’Œçµæ´»çš„åŸå› ã€‚

å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ å¼€å¯ D3.js çš„å­¦ä¹ ä¹‹æ—…ï¼ğŸš€

